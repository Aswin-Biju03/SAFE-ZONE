{% include 'admin_header.html' %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emergency</title>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            // Select the form
            const form = document.querySelector('form');
    
            form.addEventListener('submit', function (e) {
                // Get all input elements
                const name = form.querySelector('input[name="name"]');
                const phone = form.querySelector('input[name="phone"]');
                const email = form.querySelector('input[name="email"]');
                const username = form.querySelector('input[name="username"]'); // Optional for update
                const password = form.querySelector('input[name="password"]'); // Optional for update
    
                // Regex patterns
                const namePattern = /^[A-Za-z ]+$/;
                const phonePattern = /^[0-9]{2,3}$/;
                const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                const passwordPattern = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{8,}$/;
    
                // Validate name
                if (!namePattern.test(name.value.trim())) {
                    alert('Please enter a valid name (letters and spaces only).');
                    e.preventDefault();
                    return;
                }
    
                // Validate phone
                if (!phonePattern.test(phone.value.trim())) {
                    alert('Please enter a valid 2-digit or 3-digit number.');
                    e.preventDefault();
                    return;
                }
    
                // Validate email
                if (!emailPattern.test(email.value.trim())) {
                    alert('Please enter a valid email address.');
                    e.preventDefault();
                    return;
                }
    
                // Validate username (for Add functionality)
                if (username && username.value.trim() === '') {
                    alert('Username is required.');
                    e.preventDefault();
                    return;
                }
    
                // Validate password (for Add functionality)
                if (password && !passwordPattern.test(password.value.trim())) {
                    alert('Password must contain at least 1 number, 1 uppercase and lowercase letter, and be at least 8 characters long.');
                    e.preventDefault();
                    return;
                }
            });

            // Add event listeners for delete and update actions
            const deleteLinks = document.querySelectorAll('a.btn-danger');
            deleteLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    if (!confirm('Are you sure you want to delete this emergency contact?')) {
                        e.preventDefault();
                    }
                });
            });

            const updateLinks = document.querySelectorAll('a.btn-primary');
            updateLinks.forEach(link => {
                link.addEventListener('click', function (e) {
                    if (!confirm('Are you sure you want to update this emergency contact?')) {
                        e.preventDefault();
                    }
                });
            });
        });
    </script>
    
</head>

<body>

<center>
    <br><br><br><br><br>
    <h3>Manage Emergency</h3>
    <form  method="post" enctype="multipart/form-data" >
        {%if data['upd']%}
        <table>
            <h4>Update Details</h4>
            <tr><th>Name</th>
            <td><input type="text" name="name" value="{{data['upd'][0]['emergency_name']}}" class="form-control"></td></tr>
            <th>Phone</th>
            <td><input type="text" name="phone" value="{{data['upd'][0]['phone']}}"class="form-control"></td></tr>
            <th>Email</th>
            <td><input type="text" name="email" value="{{data['upd'][0]['email']}}" class="form-control" required></td></tr>
            <tr><th><input type="submit" name="up" class="btn btn-primary" value="update"></th></tr>
        </table>
        {%else%}
        <table>
            <tr><th>Name</th>
                <td><input type="text" name="name"  placeholder="Name"  class="form-control"></td></tr>
            <tr><th>Phone</th>
                <td><input type="text" name="phone" class="form-control" placeholder="Number"  ></td></tr>
            <tr><th>Email</th>
                <td><input type="email" name="email" placeholder="abc@gmail.com" class="form-control"></td></tr>
            <tr><th>username</th>
                <td><input type="text" name="username" placeholder="username"  class="form-control" ></td></tr>
            <tr><th>password</th>
                <td><input type="password" name="password" placeholder="password" class="form-control" ></td></tr>
            <tr><th><input type="submit" name="add_emergency" class="btn btn-primary" value="Add"></th></tr>
        </table>
        {%endif%}
        <br>
        <h4>Emergency List</h4>
        <br>
        <table class="t">
            <tr ><th class="t1">Index</th>
            <th class="t1">Name</th>
            <th class="t1">Phone</th>
            <th class="t1">Email</th>
            <th class="t1">Actions</th>
        </tr>
            {%for i in data['resource']%}
            <tr>
                <td class="t1">{{loop.index}}</td>
                <td class="t1">{{i['emergency_name']}}</td>
                <td class="t1">{{i['phone']}}</td>
                <td class="t1">{{i['email']}}</td>
                <td class="t1">
                    <a href="?action=delete&emergency_id={{i['emergency_id']}}&lid={{ i['login_id'] }}" class="btn btn-danger">delete</a>
                    <a href="?action=update&emergency_id={{i['emergency_id']}}&lid={{ i['login_id'] }}" class="btn btn-primary">update</a>
                </td>
            </tr>
            {%endfor%}
        </table>
        <br><br><br><br><br><br><br><br><br>
    </form>

</center>

{% include 'footer.html' %}</td>